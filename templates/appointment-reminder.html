<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>预约提醒管理</title>
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
  <style type="text/tailwindcss">
    @theme {
      --color-primary: #3b82f6;
      --color-secondary: #10b981;
      --color-danger: #ef4444;
      --color-dark: #1e293b;
      --color-light: #f8fafc;
      --font-inter: 'Inter', sans-serif;
    }
    body {
      font-family: var(--font-inter);
    }
    .table-header-blue {
      background-color: var(--color-primary);
      color: white;
    }
    .reminder-modal {
      display: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
    }
  </style>
</head>
<body class="bg-gray-50 p-6">
  <h1 class="text-2xl font-bold mb-4">预约提醒管理</h1>

  <!-- 提醒弹窗 -->
  <div class="reminder-modal" id="reminderModal">
    <div class="modal-content">
      <h3 class="text-lg font-bold mb-2" id="modalTitle">就诊提醒</h3>
      <p class="mb-4" id="modalMessage">患者将在30分钟内就诊</p>
      <button class="bg-primary text-white px-4 py-2 rounded" onclick="closeModal()">确认</button>
    </div>
  </div>

  <table class="w-full border-collapse border border-gray-300">
    <thead>
      <tr class="table-header-blue">
        <th class="p-2">挂号单号</th>
        <th class="p-2">患者姓名</th>
        <th class="p-2">就诊时间</th>
        <th class="p-2">提醒状态</th>
        <th class="p-2">操作</th>
      </tr>
    </thead>
    <tbody id="appointmentTable">
      <!-- 数据将通过JS动态加载 -->
    </tbody>
  </table>

  <script>
    // 模拟预约数据（实际项目中应从后端API获取）
    const appointments = [
      { id: 1, registrationNo: "GH001", patientName: "张三", visitTime: "2024-01-02 09:30", remindStatus: 0 },
      { id: 2, registrationNo: "GH002", patientName: "李四", visitTime: "2024-01-02 10:00", remindStatus: 0 },
      { id: 3, registrationNo: "GH003", patientName: "王五", visitTime: "2024-01-02 14:30", remindStatus: 1 },
      { id: 4, registrationNo: "GH004", patientName: "赵六", visitTime: "2024-01-03 09:15", remindStatus: 0 }
    ];

    // 页面加载时渲染表格数据
    document.addEventListener('DOMContentLoaded', function() {
      renderAppointments();
      checkUpcomingAppointments();

      // 每30秒检查一次即将到来的预约
      setInterval(checkUpcomingAppointments, 30000);
    });

    // 渲染预约表格
    function renderAppointments() {
      const tableBody = document.getElementById('appointmentTable');
      tableBody.innerHTML = '';

      appointments.forEach(appointment => {
        const row = document.createElement('tr');
        row.className = 'hover:bg-gray-50 transition-colors';

        // 状态颜色样式
        const statusClass = appointment.remindStatus === 0 ?
          'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800';
        const statusText = appointment.remindStatus === 0 ? '未提醒' : '已提醒';

        // 操作按钮
        let actionButton;
        if (appointment.remindStatus === 0) {
          actionButton = `
            <button class="bg-secondary text-white p-1 rounded"
                    onclick="sendReminder(${appointment.id})">
              <i class="fas fa-bell mr-1"></i>发送提醒
            </button>
          `;
        } else {
          actionButton = `
            <span class="bg-gray-200 text-gray-700 p-1 rounded">已提醒</span>
          `;
        }

        row.innerHTML = `
          <td class="p-2 border border-gray-300">${appointment.registrationNo}</td>
          <td class="p-2 border border-gray-300">${appointment.patientName}</td>
          <td class="p-2 border border-gray-300">${appointment.visitTime}</td>
          <td class="p-2 border border-gray-300 ${statusClass}">${statusText}</td>
          <td class="p-2 border border-gray-300">${actionButton}</td>
        `;

        tableBody.appendChild(row);
      });
    }

    // 发送提醒功能
    function sendReminder(appointmentId) {
      const appointment = appointments.find(a => a.id === appointmentId);
      if (!appointment) return;

      // 模拟发送提醒请求（实际项目中应调用后端API）
      // 这里假设提醒发送成功
      appointment.remindStatus = 1;

      // 显示提醒成功消息
      showNotification(`已成功向 ${appointment.patientName} 发送就诊提醒`);

      // 更新表格
      renderAppointments();
    }

    // 检查即将到来的预约（30分钟内）
    function checkUpcomingAppointments() {
      const now = new Date();
      const thirtyMinutesLater = new Date(now.getTime() + 30 * 60 * 1000);

      appointments.forEach(appointment => {
        const visitTime = new Date(appointment.visitTime);

        // 检查就诊时间是否在30分钟内且未提醒
        if (visitTime <= thirtyMinutesLater && visitTime > now && appointment.remindStatus === 0) {
          showReminderModal(appointment.patientName, appointment.visitTime);
        }
      });
    }

    // 显示提醒弹窗
    function showReminderModal(patientName, visitTime) {
      const modal = document.getElementById('reminderModal');
      const title = document.getElementById('modalTitle');
      const message = document.getElementById('modalMessage');

      title.textContent = "重要就诊提醒";
      message.textContent = `${patientName} 您的就诊时间为 ${visitTime}，请提前做好准备！`;
      modal.style.display = 'flex';
    }

    // 关闭弹窗
    function closeModal() {
      document.getElementById('reminderModal').style.display = 'none';
    }

    // 显示通知提示
    function showNotification(message) {
      // 创建通知元素
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-dark text-white px-4 py-2 rounded shadow-lg z-50';
      notification.textContent = message;

      // 添加到页面
      document.body.appendChild(notification);

      // 3秒后自动消失
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.5s';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 500);
      }, 3000);
    }
  </script>
</body>
</html>